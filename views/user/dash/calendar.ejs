<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Calendar â€” Evently</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            theme: {
              primary: '#1C2A3A',
              highlight: '#2C3E50',
              secondary: '#1C2A3A',
              accent: '#5C7C8A',
              dark: '#1C2A3A',
              surface: '#F9F7F5',
            },
            apple: {
              bg: '#EAE0CF',
              card: 'rgba(255, 255, 255, 0.6)',
              text: '#1C2A3A',
              secondary: '#5C7C8A',
              accent: '#1C2A3A'
            }
          },
          fontFamily: {
            heading: ['Fraunces', 'serif'],
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(237, 136, 66, 0.7);
      }

      70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(237, 136, 66, 0);
      }

      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(237, 136, 66, 0);
      }
    }

    .today-highlight {
      animation: pulse 2s infinite;
    }

    .event-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #ED8842;
      display: inline-block;
      margin-top: 4px;
    }

    .today-dot {
      position: absolute;
      top: -6px;
      right: -6px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #ED8842;
      border: 2px solid #EAE0CF;
    }

    /* Custom scrollbar for event list */
    #events-list-container::-webkit-scrollbar {
      width: 5px;
    }

    #events-list-container::-webkit-scrollbar-track {
      background: #f8f5f0;
      border-radius: 10px;
    }

    #events-list-container::-webkit-scrollbar-thumb {
      background: #d4c8b5;
      border-radius: 10px;
    }

    #events-list-container::-webkit-scrollbar-thumb:hover {
      background: #b8a995;
    }

    /* Calendar cell hover effect */
    .calendar-cell:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .calendar-cell.transition-all {
      transition: all 0.2s ease;
    }
  </style>
</head>

<body class="bg-[#EAE0CF] text-[#1C2A3A] min-h-screen">

  <!-- Global Navigation -->
  <div class="fixed top-6 w-full z-50 px-4 md:px-6">
    <nav class="max-w-7xl mx-auto bg-[#1C2A3A] rounded-full h-16 px-6 flex items-center justify-between shadow-2xl relative">
      <div class="flex items-center">
        <a href="/" class="text-xl font-bold tracking-tight text-white font-heading">evently</a>
      </div>

      <div class="hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 space-x-8 text-xs font-bold tracking-widest text-white/80 uppercase font-sans">
        <a href="/" class="hover:text-white transition-colors">For You</a>
        <a href="/events" class="hover:text-white transition-colors">Events</a>
        <a href="/venues" class="hover:text-white transition-colors">Venues</a>
      </div>

      <div class="flex items-center gap-4">
        <a href="/bookmarks" class="text-white/70 hover:text-white transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
          </svg>
        </a>
        <a href="/notifications" class="text-white/70 hover:text-white transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
            </path>
          </svg>
        </a>
        <a href="/my-bookings" class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-[#1C2A3A] hover:bg-white/90 transition-colors border border-white shadow-md">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </a>
      </div>
    </nav>
  </div>

  <div class="flex pt-28 max-w-7xl mx-auto px-4 md:px-6 gap-6">
    <!-- Sidebar Navigation - Hidden on mobile, visible on large screens -->
    <aside class="w-60 shrink-0 hidden lg:block h-[calc(100vh-8rem)] sticky top-28">
      <div class="bg-white/40 border border-[#1C2A3A]/5 backdrop-blur-3xl rounded-[2rem] p-5 h-full flex flex-col justify-between shadow-sm">
        <div>
          <div class="flex items-center gap-3 px-1 mb-6">
            <div class="w-10 h-10 rounded-full bg-[#1C2A3A] text-white flex items-center justify-center font-heading text-sm">
              JD
            </div>
            <div>
              <p class="font-bold text-[#1C2A3A] text-sm">Jaiden</p>
              <p class="text-xs text-[#1C2A3A]/60">Member</p>
            </div>
          </div>

          <nav class="space-y-1.5">
            <a href="/user/my-bookings" class="w-full flex items-center space-x-2.5 px-3.5 py-2.5 rounded-xl text-[#1C2A3A]/70 hover:bg-[#F9F7F5] hover:text-[#1C2A3A] transition-all text-sm">
              <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z">
                </path>
              </svg>
              <span>My Bookings</span>
            </a>

            <!-- Active Link -->
            <a href="/dashboard/calendar" class="w-full flex items-center space-x-2.5 px-3.5 py-2.5 rounded-xl bg-[#F9F7F5] border border-[#1C2A3A]/5 text-[#1C2A3A] font-medium transition-all shadow-sm text-sm">
              <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                </path>
              </svg>
              <span>Calendar</span>
            </a>

            <a href="/host-dashboard" class="w-full flex items-center space-x-2.5 px-3.5 py-2.5 rounded-xl text-[#1C2A3A]/70 hover:bg-[#F9F7F5] hover:text-[#1C2A3A] transition-all text-sm">
              <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                </path>
              </svg>
              <span>Host Dashboard</span>
            </a>

            <a href="/user/profile" class="w-full flex items-center space-x-2.5 px-3.5 py-2.5 rounded-xl text-[#1C2A3A]/70 hover:bg-[#F9F7F5] hover:text-[#1C2A3A] transition-all text-sm">
              <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span>Profile</span>
            </a>

            <a href="/user/wallet" class="w-full flex items-center space-x-2.5 px-3.5 py-2.5 rounded-xl text-[#1C2A3A]/70 hover:bg-[#F9F7F5] hover:text-[#1C2A3A] transition-all text-sm">
              <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                </path>
              </svg>
              <span>Wallet</span>
            </a>
          </nav>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 w-full min-w-0">
      <div class="h-full flex flex-col">
        <div class="flex flex-col md:flex-row justify-between items-end mb-6 shrink-0">
          <div>
            <h1 class="text-3xl md:text-4xl font-heading font-medium tracking-tight mb-1 md:mb-2 text-[#1C2A3A]">Calendar</h1>
            <p class="text-[#1C2A3A]/60 font-sans text-sm">Your social schedule at a glance.</p>
          </div>
          <div class="flex items-center gap-3 bg-white/40 rounded-full p-1 border border-[#1C2A3A]/5 mt-3 md:mt-0">
            <button id="prev-month" class="w-7 h-7 md:w-8 md:h-8 flex items-center justify-center rounded-full hover:bg-white text-[#1C2A3A] transition-colors">
              <svg class="w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <span id="current-month-year" class="font-heading font-bold text-[#1C2A3A] min-w-[110px] md:min-w-[120px] text-center text-sm md:text-base transition-opacity">February 2026</span>
            <button id="next-month" class="w-7 h-7 md:w-8 md:h-8 flex items-center justify-center rounded-full hover:bg-white text-[#1C2A3A] transition-colors">
              <svg class="w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                </path>
              </svg>
            </button>
          </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-6 h-full">
          <!-- Calendar Grid - Takes maximum available space -->
          <div class="flex-1 bg-white/40 border border-[#1C2A3A]/5 rounded-[1.75rem] p-4 md:p-6 shadow-sm min-h-[520px]">
            <!-- Days Header -->
            <div class="grid grid-cols-7 mb-3 md:mb-4">
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Sun</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Mon</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Tue</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Wed</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Thu</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Fri</div>
              <div class="text-center text-[9px] md:text-[10px] font-bold uppercase tracking-widest text-[#1C2A3A]/50">Sat</div>
            </div>

            <!-- Days Grid - Larger height for better visibility -->
            <div id="calendar-grid" class="grid grid-cols-7 gap-1.5 md:gap-2 auto-rows-fr h-[480px] md:h-[540px]">
              <!-- Calendar days will be dynamically generated here -->
            </div>
          </div>

          <!-- Upcoming List (Side) - Compact width -->
          <div class="w-full lg:w-64 shrink-0">
            <div class="bg-white/40 border border-[#1C2A3A]/5 rounded-[1.75rem] p-4 h-full flex flex-col shadow-sm">
              <h3 class="text-sm font-bold uppercase tracking-widest text-[#1C2A3A]/40 mb-4">This Month</h3>

              <div id="events-list-container" class="space-y-3 max-h-[480px] overflow-y-auto pr-1">
                <!-- Events will be dynamically generated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // DOM Elements
    const calendarGrid = document.getElementById('calendar-grid');
    const currentMonthYearEl = document.getElementById('current-month-year');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const eventsListContainer = document.getElementById('events-list-container');

    // Month names for display
    const monthNames = ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    const shortMonthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const weekdayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    // Events data structure - SINGLE SOURCE OF TRUTH
    let events = <%- JSON.stringify(eventToShow) %>

    // State variables - set to February 2026 as per system date
    let currentDate = new Date(); // February 5, 2026
    let currentMonth = currentDate.getMonth(); // 1 = February
    let currentYear = currentDate.getFullYear();

    // Initialize the calendar
    document.addEventListener('DOMContentLoaded', () => {
      renderCalendar();
      renderEventList();

      // Setup event listeners
      prevMonthBtn.addEventListener('click', navigateToPrevMonth);
      nextMonthBtn.addEventListener('click', navigateToNextMonth);
    });

    // Parse event date string to Date object
    function parseEventDate(dateString) {
      const [year, month, day] = dateString.split('-').map(Number);
      // Months are 0-indexed in JS, so we subtract 1
      return new Date(year, month - 1, day);
    }

    // Format time from 24h to 12h format
    function formatTime(time24h) {
      const [hours, minutes] = time24h.split(':');
      let hours12 = parseInt(hours);
      const ampm = hours12 >= 12 ? 'PM' : 'AM';
      hours12 = hours12 % 12;
      hours12 = hours12 ? hours12 : 12; // Convert 0 to 12
      return `${hours12}:${minutes} ${ampm}`;
    }

    // Render the calendar grid
    function renderCalendar() {
      // Update month/year display
      currentMonthYearEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;

      // Clear the grid
      calendarGrid.innerHTML = '';

      // Get first day of month and total days
      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const totalDays = lastDay.getDate();
      const firstDayOfWeek = firstDay.getDay(); // 0 = Sunday, 6 = Saturday

      // Get today's date for highlighting
      const today = new Date();
      const isCurrentMonth = (currentMonth === today.getMonth() && currentYear === today.getFullYear());

      // Add empty cells for days before the first day of the month
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'p-1';
        calendarGrid.appendChild(emptyCell);
      }

      // Add cells for each day of the month
      for (let day = 1; day <= totalDays; day++) {
        const dateObj = new Date(currentYear, currentMonth, day);
        const isToday = isCurrentMonth && day === today.getDate();
        const hasEvents = events.some(event => {
          const eventDate = parseEventDate(event.date);
          return eventDate.getDate() === day &&
            eventDate.getMonth() === currentMonth &&
            eventDate.getFullYear() === currentYear;
        });

        const cell = document.createElement('div');
        cell.className = 'calendar-cell rounded-xl flex flex-col items-center justify-center text-xs md:text-sm relative p-1 md:p-2 transition-all duration-200';

        // Style based on day type
        if (isToday) {
          cell.className += ' bg-[#1C2A3A] text-white font-bold today-highlight';
        } else if (hasEvents) {
          cell.className += ' bg-white border border-[#1C2A3A]/10 hover:bg-[#F9F7F5]';
        } else {
          cell.className += ' text-[#1C2A3A]/60 hover:bg-white/50';
        }

        // Add day number
        cell.innerHTML = `<span class="${isToday ? 'text-white font-bold' : ''}">${day}</span>`;

        // Add event dot indicator
        if (hasEvents && !isToday) {
          cell.innerHTML += `<span class="event-dot"></span>`;
        }

        // Add today indicator dot
        if (isToday) {
          cell.innerHTML += `<span class="today-dot"></span>`;
        }

        calendarGrid.appendChild(cell);
      }

      // Add empty cells to fill the grid (6 rows x 7 days = 42 cells)
      const totalCells = firstDayOfWeek + totalDays;
      const remainingCells = 42 - totalCells;
      for (let i = 0; i < remainingCells; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'p-1';
        calendarGrid.appendChild(emptyCell);
      }
    }

    // Render the event list for the current month
    function renderEventList() {
      // Clear container
      eventsListContainer.innerHTML = '';

      // Filter events for current month
      const monthEvents = events.filter(event => {
        const eventDate = parseEventDate(event.date);
        return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
      });

      if (monthEvents.length === 0) {
        eventsListContainer.innerHTML = `
          <div class="text-center py-8 text-[#1C2A3A]/60 text-sm">
            No events scheduled this month.
          </div>
        `;
        return;
      }

      // Sort events by date and time
      monthEvents.sort((a, b) => {
        const dateA = new Date(`${parseEventDate(a.date).toISOString().split('T')[0]}T${a.startTime}`);
        const dateB = new Date(`${parseEventDate(b.date).toISOString().split('T')[0]}T${b.startTime}`);
        return dateA - dateB;
      });

      // Render each event
      monthEvents.forEach(event => {
        const eventDate = parseEventDate(event.date);
        const day = eventDate.getDate();
        const monthIndex = eventDate.getMonth();
        const monthShort = shortMonthNames[monthIndex];
        const isToday = eventDate.toDateString() === new Date().toDateString();

        const eventElement = document.createElement('div');
        eventElement.className = 'bg-white rounded-xl p-3 border border-[#1C2A3A]/5 hover:border-[#ED8842]/30 transition-all';

        // Date badge styling based on whether it's today
        const badgeClasses = isToday ?
          'w-10 h-10 rounded-lg bg-[#1C2A3A] text-white flex flex-col items-center justify-center flex-shrink-0' :
          'w-10 h-10 rounded-lg bg-[#F9F7F5] flex flex-col items-center justify-center text-[#1C2A3A] flex-shrink-0';

        // REMOVED VENUE FROM DISPLAY - Only showing time now
        eventElement.innerHTML = `
          <div class="flex gap-3">
            <div class="${badgeClasses}">
              <span class="text-[8px] uppercase font-bold ${isToday ? 'opacity-80' : 'text-[#1C2A3A]/50'}">${monthShort}</span>
              <span class="font-bold font-heading text-base">${day}</span>
            </div>
            <div class="flex-1 min-w-0">
              <h4 class="font-heading text-[#1C2A3A] font-medium text-sm leading-tight">${event.title}</h4>
              <p class="text-[11px] text-[#1C2A3A]/70 mt-1">${formatTime(event.startTime)}</p>
            </div>
          </div>
        `;

        eventsListContainer.appendChild(eventElement);
      });
    }

    // Navigate to previous month
    function navigateToPrevMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
      renderEventList();
    }

    // Navigate to next month
    function navigateToNextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
      renderEventList();
    }
  </script>
</body>

</html>