<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Tickets — Evently</title>
  <!-- Remove extra spaces in CDN URL -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            theme: {
              primary: '#1C2A3A',
              highlight: '#2C3E50',
              accent: '#ED8842',
              surface: '#F9F7F5'
            },
          },
          fontFamily: {
            heading: ['Fraunces', 'serif'],
            sans: ['Inter', 'sans-serif']
          },
          animation: {
            'fade-in': 'fadeIn 0.4s ease-out forwards',
            'slide-up': 'slideUp 0.5s ease-out forwards',
            'pulse-slow': 'pulse 3s infinite'
          },
          keyframes: {
            fadeIn: {
              '0%': {
                opacity: 0,
                transform: 'translateY(10px)'
              },
              '100%': {
                opacity: 1,
                transform: 'translateY(0)'
              }
            },
            slideUp: {
              '0%': {
                opacity: 0,
                transform: 'translateY(20px)'
              },
              '100%': {
                opacity: 1,
                transform: 'translateY(0)'
              }
            }
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    .animate-slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
  </style>
</head>

<body class="bg-[#EAE0CF] min-h-screen transition-colors duration-300">
  <!-- Navbar -->
  <%- include('../../partials/navbar') %>

  <main class="pt-32 pb-16 px-6 max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Booking Form -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Event Info -->
        <div class="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 md:p-8 border border-white/40 shadow-sm animate-fade-in">
          <div class="flex items-start gap-6">
            <img src="<%= event.galleryImages[0] %>" class="w-24 h-24 rounded-xl object-cover shadow-md" alt="Event" />
            <div class="flex-1">
              <h1 class="text-2xl font-heading font-medium text-[#1C2A3A] mb-2"><%= event.title %></h1>
              <div class="flex flex-wrap gap-4 text-sm text-[#1C2A3A]/60">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  <span><%= event.sDate.date %> • <%= event.sDate.time %></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ticket Selection -->
        <div class="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 md:p-8 border border-white/40 shadow-sm animate-fade-in" style="animation-delay: 0.1s">
          <h2 class="text-xl font-heading font-medium text-[#1C2A3A] mb-6">Select Tickets</h2>

          <div class="space-y-4" id="ticket-options">
            <% for(let i = 0; i < event.ticketTypes.length; i++) { %>
            <label class="block relative cursor-pointer group">
              <input type="radio" name="ticketType" value="<%= i %>" class="peer sr-only" onchange="selectTicketType(<%= i %>)" />
              <div class="flex items-center justify-between p-4 rounded-xl border border-[#1C2A3A]/10 peer-checked:border-[#1C2A3A] peer-checked:bg-[#1C2A3A]/5 transition-all duration-300">
                <div class="flex items-center gap-4">
                  <div class="w-5 h-5 rounded-full border-2 border-[#1C2A3A]/20 peer-checked:border-[#1C2A3A] flex items-center justify-center">
                    <div class="w-2.5 h-2.5 rounded-full bg-[#1C2A3A] opacity-0 peer-checked:opacity-100 transition-opacity duration-200">
                    </div>
                  </div>
                  <div>
                    <p class="font-medium text-[#1C2A3A]"><%= event.ticketTypes[i].name %></p>
                    <p class="text-sm text-[#1C2A3A]/60"><%= event.ticketTypes[i].description %></p>
                  </div>
                </div>
                <p class="text-lg font-bold text-[#1C2A3A]">$<%= event.ticketTypes[i].prize %></p>
              </div>
            </label>
            <% } %>
          </div>

          <!-- Quantity Selector -->
          <div id="quantity-selector" class="hidden mt-6 pt-6 border-t border-[#1C2A3A]/10">
            <div class="flex items-center justify-between animate-fade-in">
              <span class="font-bold text-[#1C2A3A]">Quantity</span>
              <div class="flex items-center gap-4">
                <button onclick="updateGlobalQuantity(-1)" class="w-10 h-10 rounded-xl bg-[#1C2A3A]/10 hover:bg-[#1C2A3A]/20 transition-colors flex items-center justify-center">
                  <svg class="w-5 h-5 text-[#1C2A3A]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                  </svg>
                </button>
                <span id="global-qty" class="w-8 text-center font-bold text-xl text-[#1C2A3A]">1</span>
                <button onclick="updateGlobalQuantity(1)" class="w-10 h-10 rounded-xl bg-[#1C2A3A] hover:bg-[#2C3E50] transition-colors flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Attendee & Payment Info (with staggered animation) -->
        <div class="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 md:p-8 border border-white/40 shadow-sm animate-fade-in" style="animation-delay: 0.2s">
          <h2 class="text-xl font-heading font-medium text-[#1C2A3A] mb-6">Attendee Information</h2>
          <form class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div><input type="text" required placeholder="First Name" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
              <div><input type="text" required placeholder="Last Name" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
            </div>
            <div><input type="email" required placeholder="Email Address" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
            <div><input type="tel" required placeholder="Phone Number" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
          </form>
        </div>

        <div class="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 md:p-8 border border-white/40 shadow-sm animate-fade-in" style="animation-delay: 0.3s">
          <h2 class="text-xl font-heading font-medium text-[#1C2A3A] mb-6">Payment Information</h2>
          <form class="space-y-4">
            <div><input type="text" required placeholder="Card Number" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="text" required placeholder="MM/YY" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
              <div><input type="text" required placeholder="CVV" class="w-full bg-white/50 border border-[#1C2A3A]/10 rounded-xl px-4 py-3 text-[#1C2A3A] font-medium focus:outline-none focus:ring-2 focus:ring-[#1C2A3A]/20 transition-all" /></div>
            </div>
          </form>
        </div>
      </div>

      <!-- Order Summary Sidebar -->
      <div class="lg:col-span-1 animate-fade-in" style="animation-delay: 0.15s">
        <div class="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 md:p-8 border border-white/40 shadow-sm sticky top-32">
          <h2 class="text-xl font-heading font-medium text-[#1C2A3A] mb-6">Order Summary</h2>

          <div class="space-y-4 mb-6">
            <div id="cart-item" class="hidden pb-4 border-b border-[#1C2A3A]/10">
              <div class="flex justify-between mb-1">
                <span class="text-[#1C2A3A]" id="summary-name">Ticket</span>
                <span class="font-medium text-[#1C2A3A]">$<span id="summary-total">0.00</span></span>
              </div>
              <p class="text-xs text-[#1C2A3A]/60"><span id="summary-qty">0</span> × $<span id="summary-price">0.00</span></p>
            </div>

            <div id="empty-cart" class="text-center py-8">
              <svg class="w-12 h-12 mx-auto text-[#1C2A3A]/20 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
              </svg>
              <p class="text-sm text-[#1C2A3A]/40">No tickets selected</p>
            </div>
          </div>

          <div class="space-y-3 pt-4 border-t border-[#1C2A3A]/10">
            <div class="flex justify-between text-sm">
              <span class="text-[#1C2A3A]/60">Subtotal</span>
              <span class="font-medium text-[#1C2A3A]">$<span id="subtotal">0.00</span></span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-[#1C2A3A]/60">Service Fee (10%)</span>
              <span class="font-medium text-[#1C2A3A]">$<span id="service-fee">0.00</span></span>
            </div>
            <div class="flex justify-between text-lg font-heading font-bold pt-3 border-t border-[#1C2A3A]/10">
              <span class="text-[#1C2A3A]">Total</span>
              <span class="text-[#1C2A3A]">$<span id="total">0.00</span></span>
            </div>
          </div>

          <a href="/order-confirmation" id="checkout-btn" class="block w-full mt-6 bg-[#1C2A3A] text-white rounded-xl py-4 font-bold text-sm shadow-lg hover:bg-[#2C3E50] transition-all duration-300 text-center pointer-events-none opacity-50">
            Complete Booking
          </a>

          <div class="mt-6 pt-6 border-t border-[#1C2A3A]/10">
            <div class="flex items-start gap-3 text-xs text-[#1C2A3A]/60">
              <svg class="w-4 h-4 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
              <p>Your payment information is secure and encrypted</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-6">
      <div id="modalContent" class="bg-white/90 backdrop-blur-xl rounded-[2rem] p-8 md:p-12 max-w-md w-full shadow-2xl border border-white/40 opacity-0 scale-95 transition-all duration-500">
        <div class="text-center">
          <div class="w-20 h-20 mx-auto mb-6 bg-green-500 rounded-full flex items-center justify-center animate-pulse-slow">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <h2 class="text-2xl font-heading font-bold text-[#1C2A3A] mb-2">Booking Confirmed!</h2>
          <p class="text-[#1C2A3A]/60 mb-6">Your tickets have been successfully booked</p>
          <div class="bg-[#1C2A3A]/5 rounded-xl p-4 mb-6">
            <p class="text-sm text-[#1C2A3A]/60 mb-1">Confirmation sent to</p>
            <p class="font-medium text-[#1C2A3A]" id="confirmEmail">john.doe@example.com</p>
          </div>
          <div class="space-y-3">
            <a href="/ticket" class="block w-full bg-[#1C2A3A] text-white rounded-xl py-3 font-bold text-sm shadow-lg hover:bg-[#2C3E50] transition-colors">
              View Ticket
            </a>
            <a href="/dashboard" class="block w-full bg-white border border-[#1C2A3A]/20 text-[#1C2A3A] rounded-xl py-3 font-bold text-sm hover:bg-[#1C2A3A]/5 transition-colors">
              Go to Dashboard
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Dynamically load ticket data from EJS
    const ticketTypes = <%= JSON.stringify(event.ticketTypes) %>;
    let selectedTypeIndex = null;
    let quantity = 1;

    function selectTicketType(index) {
      selectedTypeIndex = index;
      quantity = 1;
      document.getElementById('quantity-selector').classList.remove('hidden');
      updateUI();
    }

    function updateGlobalQuantity(change) {
      if (selectedTypeIndex === null) return;
      quantity = Math.max(1, quantity + change);
      updateUI();
    }

    function updateUI() {
      const subtotalEl = document.getElementById('subtotal');
      const feeEl = document.getElementById('service-fee');
      const totalEl = document.getElementById('total');
      const cartItem = document.getElementById('cart-item');
      const emptyCart = document.getElementById('empty-cart');
      const checkoutBtn = document.getElementById('checkout-btn');

      if (selectedTypeIndex === null) {
        subtotalEl.textContent = "0.00";
        feeEl.textContent = "0.00";
        totalEl.textContent = "0.00";
        cartItem.classList.add('hidden');
        emptyCart.classList.remove('hidden');
        checkoutBtn.classList.add('pointer-events-none', 'opacity-50');
        return;
      }

      const ticket = ticketTypes[selectedTypeIndex];
      const price = parseFloat(ticket.prize);
      const subtotal = price * quantity;
      const serviceFee = subtotal * 0.1;
      const total = subtotal + serviceFee;

      document.getElementById('summary-name').textContent = ticket.name;
      document.getElementById('summary-price').textContent = price.toFixed(2);
      document.getElementById('summary-qty').textContent = quantity;
      document.getElementById('summary-total').textContent = subtotal.toFixed(2);

      subtotalEl.textContent = subtotal.toFixed(2);
      feeEl.textContent = serviceFee.toFixed(2);
      totalEl.textContent = total.toFixed(2);

      cartItem.classList.remove('hidden');
      emptyCart.classList.add('hidden');
      checkoutBtn.classList.remove('pointer-events-none', 'opacity-50');
    }

    // Simulate successful booking (for demo)
    document.getElementById('checkout-btn').addEventListener('click', function(e) {
      e.preventDefault();
      if (selectedTypeIndex === null) return;

      const modal = document.getElementById('successModal');
      const content = document.getElementById('modalContent');
      modal.classList.remove('hidden');
      setTimeout(() => {
        content.style.opacity = '1';
        content.style.transform = 'scale(1)';
      }, 10);
    });

    // Close modal on click outside
    document.getElementById('successModal').addEventListener('click', function(e) {
      if (e.target === this) {
        const content = document.getElementById('modalContent');
        content.style.opacity = '0';
        content.style.transform = 'scale(0.95)';
        setTimeout(() => this.classList.add('hidden'), 500);
      }
    });

    // Initialize
    updateUI();
  </script>
</body>

</html>