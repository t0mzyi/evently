<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Categories ‚Äî Evently</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    .category-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .category-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .event-card {
      transition: all 0.2s;
    }

    .event-card:hover {
      background-color: rgba(255, 255, 255, 0.7);
    }

    .prev-btn:disabled,
    .next-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>

<body class="bg-[#EAE0CF] text-[#1C2A3A] min-h-screen">
  <!-- Navbar -->
  <%- include('../../partials/navbar') %>

  <main class="pt-32 pb-16 px-4 sm:px-6">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-heading font-bold tracking-tight mb-4">Discover Events</h1>
        <p class="text-xl text-[#1C2A3A]/70 max-w-2xl mx-auto">
          Browse events by category. Find something exciting happening near you!
        </p>
      </div>

      <!-- Categories List -->
      <div class="space-y-12">
        <% categories.forEach(cat => { %>
        <div class="category-card bg-white/70 backdrop-blur-xl rounded-3xl p-6 md:p-8 border border-white/40 shadow-sm">
          <!-- Category Header -->
          <div class="flex items-center gap-4 mb-6">
            <div class="w-14 h-14 rounded-2xl bg-purple-500/10 flex items-center justify-center">
              <span class="text-2xl"><%= cat.iconUrl %></span>
            </div>
            <div>
              <h2 class="text-2xl font-heading font-bold tracking-tight"><%= cat.name %></h2>
              <p class="text-[#1C2A3A]/60 text-sm">
                <%= cat.events.length %> event<%= cat.events.length !== 1 ? 's' : '' %>
              </p>
            </div>
          </div>

          <!-- Events Section -->
          <div class="relative">
            <% if (cat.events.length === 0) { %>
            <!-- No Events Message -->
            <div class="text-center py-12">
              <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center">
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.497-.867-6.29-2.336M18 8a6 6 0 10-12 0 6 6 0 0012 0z"></path>
                </svg>
              </div>
              <h3 class="text-lg font-medium text-[#1C2A3A]/80 mb-2">No events scheduled</h3>
              <p class="text-[#1C2A3A]/60 max-w-md mx-auto">
                Check back later or explore other categories for exciting events!
              </p>
            </div>
            <% } else { %>
            <!-- Events Carousel -->
            <div class="events-container" data-category="<%= cat._id %>">
              <div class="events-wrapper flex transition-transform duration-300 ease-in-out">
                <% cat.events.forEach(event => { %>
                <div class="event-card w-full sm:w-[320px] flex-shrink-0 mr-6 last:mr-0">
                  <a href="/events/<%= event._id %>" class="block">
                    <div class="bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-lg transition-shadow">
                      <!-- First Gallery Image -->
                      <% if (event.galleryImages && event.galleryImages.length > 0) { %>
                      <div class="h-48 overflow-hidden">
                        <img src="<%= event.galleryImages[0] %>" alt="<%= event.title %>" class="w-full h-full object-cover">
                      </div>
                      <% } else { %>
                      <!-- Fallback if no images -->
                      <div class="h-48 bg-gray-100 flex items-center justify-center">
                        <div class="text-5xl text-gray-300">üñºÔ∏è</div>
                      </div>
                      <% } %>

                      <!-- Event Info -->
                      <div class="p-4">
                        <h3 class="font-heading font-medium text-lg mb-2 line-clamp-1"><%= event.title %></h3>
                        <p class="text-[#1C2A3A]/70 text-sm line-clamp-2">
                          <%= event.description %>
                        </p>
                      </div>
                    </div>
                  </a>
                </div>
                <% }) %>
              </div>

              <!-- Navigation Buttons (always rendered, hidden by JS if not needed) -->
              <button class="prev-btn absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 w-10 h-10 rounded-full bg-white/80 shadow-md flex items-center justify-center hover:bg-white transition-colors z-10 hidden md:block">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              <button class="next-btn absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 w-10 h-10 rounded-full bg-white/80 shadow-md flex items-center justify-center hover:bg-white transition-colors z-10 hidden md:block">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
            </div>
            <% } %>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </main>

  <script>
    // Initialize carousels
    function initCarousels() {
      document.querySelectorAll('.events-container').forEach(container => {
        const wrapper = container.querySelector('.events-wrapper');
        const prevBtn = container.querySelector('.prev-btn');
        const nextBtn = container.querySelector('.next-btn');
        const eventCards = container.querySelectorAll('.event-card');

        // Detect mobile dynamically
        const isMobile = window.innerWidth < 768;
        const visibleCount = isMobile ? 1 : 2;
        const totalEvents = eventCards.length;

        let currentIndex = 0;

        // Hide buttons if not needed
        if (totalEvents <= visibleCount) {
          if (prevBtn) prevBtn.classList.add('hidden');
          if (nextBtn) nextBtn.classList.add('hidden');
          return;
        }

        // Show buttons (they're hidden by default on mobile via Tailwind)
        if (prevBtn) prevBtn.classList.remove('hidden');
        if (nextBtn) nextBtn.classList.remove('hidden');

        function updateCarousel() {
          const cardWidth = 320; // Matches sm:w-[320px]
          const gap = 24; // Matches mr-6 (1.5rem = 24px)
          const offset = -currentIndex * (cardWidth + gap);
          wrapper.style.transform = `translateX(${offset}px)`;

          if (prevBtn) prevBtn.disabled = currentIndex === 0;
          if (nextBtn) nextBtn.disabled = currentIndex >= totalEvents - visibleCount;
        }

        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
              currentIndex--;
              updateCarousel();
            }
          });
        }

        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
            if (currentIndex < totalEvents - visibleCount) {
              currentIndex++;
              updateCarousel();
            }
          });
        }

        updateCarousel();
      });
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', initCarousels);

    // Handle window resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        // Re-initialize carousels
        document.querySelectorAll('.events-container').forEach(container => {
          const wrapper = container.querySelector('.events-wrapper');
          wrapper.style.transform = 'translateX(0)';
        });
        initCarousels();
      }, 250);
    });
  </script>
</body>

</html>